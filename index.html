<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexagon Plot Grouped by Male-Female Compositions</title>
    <script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <h1 style="text-align: center;">Hexagon Plot Grouped by Male-Female Compositions</h1>
    <div id="groupedPlot" style="width: 100%; height: 30vh;"></div>

    <script>
        // Define colors for genders
        const genderColors = { "MALE": "blue", "FEMALE": "pink" };

        // Function to calculate hexagon vertices
        function hexagonVertices(xCenter, yCenter, size) {
            const angles = Array.from({ length: 7 }, (_, i) => (i * 2 * Math.PI) / 6);
            const x = angles.map(angle => xCenter + size * Math.cos(angle));
            const y = angles.map(angle => yCenter + size * Math.sin(angle));
            return [x, y];
        }

        // Function to create the hexagon plot grouped by male-female composition
        function createGroupedPlot(data) {
            // Group teams by male-female compositions
            const compositionGroups = {};
            data.forEach(row => {
                const maleCount = row.maleCount;
                const femaleCount = 6 - maleCount;
                const group = `${maleCount} Males, ${femaleCount} Females`;

                if (!compositionGroups[group]) {
                    compositionGroups[group] = [];
                }
                compositionGroups[group].push(row);
            });

            // Sort groups by male count (descending)
            const sortedGroups = Object.keys(compositionGroups).sort((a, b) => {
                const maleA = parseInt(a.split(" ")[0]);
                const maleB = parseInt(b.split(" ")[0]);
                return maleB - maleA;
            });

            const traces = [];
            const spacingFactor = 5; // Spacing between x-axis categories
            const hexSize = 1.5; // Smaller hexagon size
            let xIndex = 0;

            // Generate traces for each group
            sortedGroups.forEach(group => {
                const teams = compositionGroups[group];
                teams.forEach((row, teamIndex) => {
                    const team = row["Team"];
                    const grade = parseFloat(row["GRADE"]);
                    const members = [
                        row["Member 1"], row["Member 2"], row["Member 3"],
                        row["Member 4"], row["Member 5"], row["Member 6"]
                    ].map(m => m.trim().toUpperCase());

                    const maleCount = members.filter(m => m === "MALE").length;
                    const xCenter = xIndex * spacingFactor; // Grouped by xIndex with spacing
                    const yCenter = grade; // Use grade for vertical positioning

                    // Add hexagon segments
                    for (let j = 0; j < 6; j++) {
                        const angle = j * (2 * Math.PI / 6);
                        const nextAngle = (j + 1) * (2 * Math.PI / 6);

                        const xCoords = [
                            xCenter,
                            xCenter + hexSize * Math.cos(angle),
                            xCenter + hexSize * Math.cos(nextAngle),
                            xCenter
                        ];
                        const yCoords = [
                            yCenter,
                            yCenter + hexSize * Math.sin(angle),
                            yCenter + hexSize * Math.sin(nextAngle),
                            yCenter
                        ];

                        const color = j < maleCount ? genderColors["MALE"] : genderColors["FEMALE"];

                        traces.push({
                            x: xCoords,
                            y: yCoords,
                            fill: "toself",
                            mode: "lines",
                            fillcolor: color,
                            line: { color: "black", width: 0.5 },
                            text: `Team: ${team}<br>Grade: ${grade}<br>Males: ${maleCount}<br>Females: ${6 - maleCount}`,
                            hoverinfo: "text"
                        });
                    }
                });

                // Increment xIndex for the next group
                xIndex += 1;
            });

            // Create x-axis categories
            Plotly.newPlot("groupedPlot", traces, {
                xaxis: {
                    title: "Male-Female Composition",
                    tickvals: Array.from({ length: sortedGroups.length }, (_, i) => i * spacingFactor),
                    ticktext: sortedGroups,
                    categoryorder: "array",
                    categoryarray: sortedGroups,
                },
                yaxis: {
                    title: "Grade",
                },
                showlegend: true,
                height: 600,
                width: 1500
            });
        }

        // Parse the CSV and create plot
        Papa.parse("Sample File HCDIV.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const validData = results.data.filter(row => row["Team"] && row["GRADE"]);
                validData.forEach(row => {
                    const members = [
                        row["Member 1"], row["Member 2"], row["Member 3"],
                        row["Member 4"], row["Member 5"], row["Member 6"]
                    ].map(m => m.trim().toUpperCase());

                    row.maleCount = members.filter(m => m === "MALE").length;
                });

                // Create the grouped plot
                createGroupedPlot(validData);
            }
        });
    </script>
</body>
</html>
