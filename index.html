<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Pair Heatmap</title>
    <!-- Load Plotly.js from CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="heatmap" style="width: 80%; height: 80vh; margin: 0 auto;"></div>

    <script>
        // Function to load CSV data
        function loadCSV(url, callback) {
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').slice(1); // Skip header row
                    const parsedData = rows.map(row => {
                        const columns = row.split(',');
                        return {
                            'Student 1': columns[0].trim(),
                            'Student 2': columns[1].trim(),
                            'Average_Grade': parseFloat(columns[2].trim())
                        };
                    });
                    callback(parsedData);
                });
        }

        // Load and process the data from the CSV
        loadCSV('data.csv', function(data) {
            // Extract unique students
            const students = Array.from(new Set(data.flatMap(row => [row['Student 1'], row['Student 2']])));
            students.sort(); // Sort the student names

            // Create a mapping from student names to index
            const studentIndex = {};
            students.forEach((student, idx) => {
                studentIndex[student] = idx;
            });

            // Create a matrix for the heatmap
            const heatmapMatrix = Array.from({ length: students.length }, () => Array(students.length).fill(null));

            // Fill the matrix with data
            data.forEach(row => {
                const i = studentIndex[row['Student 1']];
                const j = studentIndex[row['Student 2']];
                const grade = row['Average_Grade'];

                // Ensure the matrix is symmetric
                heatmapMatrix[i][j] = grade;
                heatmapMatrix[j][i] = grade;
            });

            // Create a Plotly heatmap
            const trace = {
                z: heatmapMatrix,
                x: students,
                y: students,
                type: 'heatmap',
                colorscale: 'YlGnBu',
                colorbar: {
                    title: 'Average Grade'
                },
                showscale: true,
                zmin: 0, // Set minimum value to 0 for better scaling
                zmax: 100 // Set maximum value to 100 for better scaling
            };

            // Layout for the heatmap
            const layout = {
                title: 'Heatmap of Average Grades for Student Pairs',
                xaxis: {
                    title: 'Student 1',
                    tickmode: 'array',
                    tickvals: students,
                    ticktext: students
                },
                yaxis: {
                    title: 'Student 2',
                    tickmode: 'array',
                    tickvals: students,
                    ticktext: students
                },
                autosize: true
            };

            // Plot the heatmap
            Plotly.newPlot('heatmap', [trace], layout);
        });
    </script>
</body>
</html>
