<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploring the Correlation Between Team Compositions (Gender) and Team's Performance in a Design Project</title>
    <script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</head>
<body>
    <h1 style="text-align: center;">Exploring the Correlation Between Team Compositions (Gender) and Team's Performance in a Design Project</h1>
    <h3>Abstract</h3>
    <p style="text-align: justify;">Design is a collaborative effort. Design projects are commonly carried out in teams, especially at the undergraduate level, to help students navigate the complexities of real-world challenges more effectively. Teamwork improves learning outcomes by providing opportunities for cross-learning and broadening students' problem-solving strategies throughout the design process. Successful teamwork requires effective cooperation, which is facilitated by clear communication and decision-making. These aspects are influenced by understanding and managing personal differences in working styles and approaches. A shared understanding within the team can enhance overall performance, driven by factors such as group potency, team effort, and the routine nature of tasks. One valuable approach to building this understanding is recognizing and addressing the personality types of team members.</p>

    <!-- Table 1: Raw Data -->
    <h3>Raw Data</h3>
    <table border="1" style="width: 80%; border-collapse: collapse; text-align: center; margin-bottom: 20px;">
        <thead>
            <tr style="background-color: #f2f2f2;">
                <th>Team</th>
                <th>Gender</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Male</td>
                <td>85</td>
            </tr>
            <tr>
                <td>7</td>
                <td>Female</td>
                <td>85</td>
            </tr>
            <tr>
                <td>10</td>
                <td>Male</td>
                <td>85</td>
            </tr>
             <tr>
                <td>...</td>
                <td>...</td>
                <td>...</td>
            </tr>
            <!-- Add more rows as needed -->
        </tbody>
    </table>

    <!-- Table 2: Cleaned Data -->
    <h3>Cleaned Data</h3>
    <table border="1" style="width: 80%; border-collapse: collapse; text-align: center; margin-bottom: 20px;">
        <thead>
            <tr style="background-color: #f2f2f2;">
                <th>Team</th>
                <th>Member 1</th>
                <th>Member 2</th>
                <th>Member 3</th>
                <th>Member 4</th>
                <th>Member 5</th>
                <th>Member 6</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Male</td>
                <td>Female</td>
                <td>Male</td>
                <td>Male</td>
                <td>Female</td>
                <td>Male</td>
                <td>85</td>
            </tr>
            <tr>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
                <td>...</td>
            </tr>
            <!-- Add more rows as needed -->
        </tbody>
    </table>

    <!-- Diagram 1: Hexagon Plot -->
    <h3>Scatterplot with Team Compositions using Hexbin Visualisation</h3>
    <div id="sortedPlot" style="width: 100%; height: 600px;"></div>

    <!-- Diagram 2: Scatterplot with Polynomial Regression -->
    <h3>Scatterplot for Polynomial Regression Analysis</h3>
    <div id="scatterPlot" style="width: 100%; height: 400px;"></div>

    <!-- Diagram 3: Linechart for Average Grades -->
    <h3>Linechart to Visualise each Group's Average</h3>
    <div id="averageLineChart" style="width: 100%; height: 400px;"></div>

    <script>
        const genderColors = { "MALE": "blue", "FEMALE": "pink" };

        // Polynomial regression function
        function polynomialRegression(x, y, degree) {
            const X = x.map(xi => Array.from({ length: degree + 1 }, (_, j) => Math.pow(xi, j)));
            const XT = math.transpose(X);
            const Y = math.matrix(y);

            const beta = math.multiply(math.inv(math.multiply(XT, X)), math.multiply(XT, Y));
            const coefficients = beta.toArray();

            return {
                coefficients,
                predict: xi => coefficients.reduce((sum, coeff, j) => sum + coeff * Math.pow(xi, j), 0),
                equation: coefficients.map((coeff, i) => `${coeff.toFixed(2)}x^${i}`).join(" + ")
            };
        }

        // Create line chart for average grades
        function createLineChart(data) {
            const compositionAverages = {};
            data.forEach(row => {
                const maleCount = row.maleCount;
                const femaleCount = 6 - maleCount;
                const group = `${maleCount} Males, ${femaleCount} Females`;

                if (!compositionAverages[group]) {
                    compositionAverages[group] = { total: 0, count: 0 };
                }
                compositionAverages[group].total += parseFloat(row["GRADE"]);
                compositionAverages[group].count += 1;
            });

            const xValues = [];
            const yValues = [];
            Object.keys(compositionAverages)
                .sort((a, b) => {
                    const maleA = parseInt(a.split(" ")[0]);
                    const maleB = parseInt(b.split(" ")[0]);
                    return maleB - maleA; 
                })
                .forEach(group => {
                    xValues.push(group);
                    yValues.push(compositionAverages[group].total / compositionAverages[group].count);
                });

            Plotly.newPlot("averageLineChart", [
                {
                    x: xValues,
                    y: yValues,
                    mode: "lines+markers",
                    line: { shape: "spline", color: "blue", width: 2 },
                    marker: { size: 8, color: "blue" },
                    text: yValues.map(avg => `Average: ${avg.toFixed(2)}`),
                    hoverinfo: "x+text"
                }
            ], {
                title: "Average Grades by Team Composition",
                xaxis: { title: "Team Composition", automargin: true },
                yaxis: { title: "Average Grade", rangemode: "tozero" },
                height: 400,
                width: 800
            });
        }

        // Create scatter plot with polynomial regression
        function createScatterPlotWithTrendline(data) {
            const compositionGroups = {};
            data.forEach(row => {
                const maleCount = row.maleCount;
                const femaleCount = 6 - maleCount;
                const group = `${maleCount} Males, ${femaleCount} Females`;

                if (!compositionGroups[group]) {
                    compositionGroups[group] = [];
                }
                compositionGroups[group].push(row);
            });

            const sortedGroups = Object.keys(compositionGroups).sort((a, b) => {
                const maleA = parseInt(a.split(" ")[0]);
                const maleB = parseInt(b.split(" ")[0]);
                return maleB - maleA;
            });

            const xValues = [];
            const yValues = [];
            const textValues = [];
            const traces = [];
            const spacingFactor = 3;
            let xIndex = 0;

            sortedGroups.forEach(group => {
                const teams = compositionGroups[group];
                teams.forEach(row => {
                    const team = row["Team"];
                    const grade = parseFloat(row["GRADE"]);

                    xValues.push(xIndex * spacingFactor);
                    yValues.push(grade);
                    textValues.push(`Team: ${team}<br>Grade: ${grade}<br>${group}`);
                });
                xIndex += 1;
            });

            traces.push({
                x: xValues,
                y: yValues,
                mode: "markers",
                marker: { size: 8, color: "blue" },
                text: textValues,
                hoverinfo: "text"
            });

            const degree = 2;
            const regression = polynomialRegression(xValues, yValues, degree);
            const trendX = Array.from({ length: 100 }, (_, i) => i * (Math.max(...xValues) / 99));
            const trendY = trendX.map(x => regression.predict(x));

            traces.push({
                x: trendX,
                y: trendY,
                mode: "lines",
                line: { color: "red", width: 2 },
                hoverinfo: "text",
                text: `Trendline Equation: y = ${regression.equation}`
            });

            Plotly.newPlot("scatterPlot", traces, {
                title: "Scatter Plot with Polynomial Regression",
                xaxis: {
                    title: "Male-Female Composition",
                    tickvals: Array.from({ length: sortedGroups.length }, (_, i) => i * spacingFactor),
                    ticktext: sortedGroups,
                    automargin: true
                },
                yaxis: { title: "Grade" },
                height: 400,
                width: 800
                showlegend: false
            });
        }

        // Create hexagon plot for sorted teams
        function createSortedPlot(data) {
            data.sort((a, b) => b.maleCount - a.maleCount);

            const traces = [];
            data.forEach((row, i) => {
                const team = row["Team"];
                const grade = parseFloat(row["GRADE"]);
                const members = [
                    row["Member 1"], row["Member 2"], row["Member 3"],
                    row["Member 4"], row["Member 5"], row["Member 6"]
                ].map(m => m.trim().toUpperCase());

                const maleCount = members.filter(m => m === "MALE").length;
                const xCenter = i * 5;
                const yCenter = grade;
                const hexSize = 2.5;

                for (let j = 0; j < 6; j++) {
                    const angle = j * (2 * Math.PI / 6);
                    const nextAngle = (j + 1) * (2 * Math.PI / 6);

                    const xCoords = [
                        xCenter,
                        xCenter + hexSize * Math.cos(angle),
                        xCenter + hexSize * Math.cos(nextAngle),
                        xCenter
                    ];
                    const yCoords = [
                        yCenter,
                        yCenter + hexSize * Math.sin(angle),
                        yCenter + hexSize * Math.sin(nextAngle),
                        yCenter
                    ];

                    const color = j < maleCount ? genderColors["MALE"] : genderColors["FEMALE"];

                    traces.push({
                        x: xCoords,
                        y: yCoords,
                        fill: "toself",
                        mode: "lines",
                        fillcolor: color,
                        line: { color: "black", width: 0.5 },
                        text: `Team: ${team}<br>Grade: ${grade}<br>Males: ${maleCount}<br>Females: ${6 - maleCount}`,
                        hoverinfo: "text"
                    });
                }
            });

            Plotly.newPlot("sortedPlot", traces, {
                xaxis: { visible: false },
                yaxis: { visible: true },
                showlegend: false,
                height: 600,
                width: 2000
            });
        }

        // Load the data
        Papa.parse("Sample File HCDIV.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const validData = results.data.filter(row => row["Team"] && row["GRADE"]);
                validData.forEach(row => {
                    const members = [
                        row["Member 1"], row["Member 2"], row["Member 3"],
                        row["Member 4"], row["Member 5"], row["Member 6"]
                    ].map(m => m.trim().toUpperCase());

                    row.maleCount = members.filter(m => m === "MALE").length;
                });

                createSortedPlot(validData);
                createScatterPlotWithTrendline(validData);
                createLineChart(validData);
            }
        });
    </script>
</body>
</html>
